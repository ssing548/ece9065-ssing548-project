<div class="container">
 
  <input class="search-bar" placeholder="Search for Songs,Playlists.." type="text" [(ngModel)]='searchBy'>
  
</div>

<mat-tab-group (selectedTabChange)="onPlaylistPanelSelected($event)">
  <mat-tab label="Songs">
    <div class="container"> 
    <button mat-raised-button class = "song-upload-button" *ngIf='isAuth' (click) = "showAddSongDialog()">Upload new Song</button>
    </div>
    <div>
      <mat-accordion>

        <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false"
          *ngFor='let song of searchedSongs'>
          <mat-expansion-panel-header>
            <mat-panel-title class="title">
              {{ song.songTitle }}
            </mat-panel-title>
            <mat-panel-description>

            </mat-panel-description>
          </mat-expansion-panel-header>
          <span><label>Album:</label>{{ song.album }}</span>
          <span><label>Artist:</label>{{ song.artist }}</span>
          <span><label>Year:</label>{{ song.year }}</span>
          <span><label>Genre:</label>{{ song.genre }}</span>
          <button mat-raised-button *ngIf='isAuth' (click)="openBottomSheet(song.songId)">Add to Playlist</button>
          <button mat-raised-button *ngIf='(isAdmin && song.visibility)' (click) = "toggleSongVisibility('hide',song.songId)">Hide Song</button>
            <button mat-raised-button *ngIf='(isAdmin && !song.visibility)' (click) = "toggleSongVisibility('show',song.songId)">Show Song</button>
            <button mat-raised-button *ngIf='(isAdmin)' (click) = "deleteSong(song.songId)">Delete</button>
            <app-review [songId]='song.songId'  [isAuth]='isAuth'></app-review>

        </mat-expansion-panel>

      </mat-accordion>
    </div>
  </mat-tab>
  <mat-tab label="Playlist"> 
      <div class="container"> 
      <button mat-raised-button class = "song-upload-button" *ngIf='isAuth' (click) = "showCreatePlaylistDialog('create',null)">Create Playlist</button>
      </div>

    <div class="" *ngIf='isAuth'> 
         <span>My Playlists</span>
    <div *ngFor='let playlist of playlists'>
        <mat-card  *ngIf='authUser.email == playlist.createdBy' >
            <div class = "card-container" (click) = "showPlaylistDialog($event,playlist.listId)"><mat-card-title class= 'title'>{{playlist.listTitle}}</mat-card-title>
            <mat-card-subtitle>{{playlist.listDesc}}</mat-card-subtitle>
            <mat-card-content>
            <span><label>Songs#</label> {{playlist.songs.length}}</span>
            <span><label>Created By:</label>{{ playlist.createdBy}}</span>   
          </mat-card-content>  </div>
          <mat-card-actions>
            <button mat-raised-button *ngIf='isAuth' (click) = "showCreatePlaylistDialog('edit',playlist.listId)">Edit</button>
            <button mat-raised-button *ngIf='isAuth && playlist.visibility' (click) = "togglePlaylistVisibility('hide',playlist.listId)">Hide Playlist</button>
            <button mat-raised-button *ngIf='isAuth && !playlist.visibility' (click) = "togglePlaylistVisibility('show',playlist.listId)">Show Playlist</button>
          </mat-card-actions>
          </mat-card>
    </div>

    </div>
    <span>Other Playlists</span>
    <div *ngFor='let playlist of searchedPlaylists'> 

    <mat-card *ngIf = '!isAuth || (isAuth && authUser.email != playlist.createdBy)' >
      <div class = "card-container" (click) = "showPlaylistDialog($event,playlist.listId)"><mat-card-title class= 'title'>{{playlist.listTitle}}</mat-card-title>
      <mat-card-subtitle>{{playlist.listDesc}}</mat-card-subtitle>
      <mat-card-content>
      <span><label>Songs#</label> {{playlist.songs.length}}</span>
      <span><label>Created By:</label>{{ playlist.createdBy}}</span>   
    </mat-card-content>  </div>
    <mat-card-actions>
    </mat-card-actions>
    </mat-card>
    </div>

  </mat-tab>

  <mat-tab *ngIf='(isAdmin)'  label="Users">

  
    <mat-card *ngFor='let user of searchedApplicationUsers'>
        <mat-card-title class= 'title'>{{user.name}}</mat-card-title>
        <mat-card-content>
            <span><label>Email:</label> {{user.email}}</span>
            <span><label>Role:</label>{{ user.role}}</span>   
          </mat-card-content>
        <mat-card-actions>
            <button mat-raised-button *ngIf='user.status =="activated"' (click) = "toggleUserStatus('deactivated',user)">Deactivate</button>
            <button mat-raised-button *ngIf='user.status =="deactivated"' (click) = "toggleUserStatus('activated',user)">Activate</button>
            <button mat-raised-button *ngIf='user.role =="admin"' (click) = "toggleAdminAccess('non-admin',user)" >Revoke Access</button>
            <button mat-raised-button *ngIf='user.role =="non-admin"' (click) = "toggleAdminAccess('admin',user)">Grant Access</button>
          </mat-card-actions>

    </mat-card>


  </mat-tab>

</mat-tab-group>